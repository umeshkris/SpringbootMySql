name: Java CI with Maven and Docker -Multipipeline

on:
  push:
    branches:
      - Springboot-sql-dev
  pull_request:
    branches:
      - main

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
          - uses : actions/checkout@v4
          - name : setup Java
            uses : actions/setup-java@v4
            with:
                java-version: '17'
                distribution: 'adopt'
                cache: maven
          - name : Build with Maven
            run : mvn -B package install -DskipTests

    deploy:
        needs: build
        runs-on: ubuntu-latest
        steps:
            - name: Login Docker
              uses: docker/login-action@v3
              with :
                username: ${{ vars.DOCKERHUB_USERNAME }}
                password: ${{ secrets.DOCKERHUB_TOKEN }}
    push :
        needs: deploy
        runs-on: ubuntu-latest
        steps:
         - uses: actions/checkout@v4    
         - name: list of  files
           run : ls -ls target
         - name: Build and push Docker image
           uses: docker/build-push-action@v6
           with:
            context: .
            file : Dockerfile
            push: true
            tags: a725133/springboot-sql:latest
       
